{"version":3,"sources":["dist/hyperapp.js"],"names":["global","factory","exports","module","define","amd","hyperapp","this","h","name","attributes","rest","children","length","arguments","push","node","pop","nodeName","key","app","state","actions","view","container","skipRender","map","rootElement","oldNode","recycleElement","element","toLowerCase","call","childNodes","nodeType","nodeValue","lifecycle","isRecycling","globalState","clone","wiredActions","wireStateToActions","path","action","data","result","get","then","scheduleRender","set","concat","resolveNode","render","patch","parent","isSvg","newElement","createElement","document","createTextNode","createElementNS","oncreate","i","appendChild","updateAttribute","insertBefore","removeElement","oldAttributes","cb","onupdate","updateElement","oldKeyed","newKeyed","oldElements","oldChildren","oldKey","getKey","k","newKey","keyedNode","setTimeout","target","source","out","value","slice","eventListener","event","currentTarget","events","type","oldValue","style","setProperty","addEventListener","removeEventListener","setAttribute","removeAttribute","done","removeChild","removeChildren","ondestroy","onremove"],"mappings":"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","sourcesContent":["(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n\ttypeof define === 'function' && define.amd ? define(['exports'], factory) :\n\t(factory((global.hyperapp = {})));\n}(this, (function (exports) { 'use strict';\n\nfunction h(name, attributes) {\n  var rest = [];\n  var children = [];\n  var length = arguments.length;\n\n  while (length-- > 2) rest.push(arguments[length]);\n\n  while (rest.length) {\n    var node = rest.pop();\n    if (node && node.pop) {\n      for (length = node.length; length--; ) {\n        rest.push(node[length]);\n      }\n    } else if (node != null && node !== true && node !== false) {\n      children.push(node);\n    }\n  }\n\n  return typeof name === \"function\"\n    ? name(attributes || {}, children)\n    : {\n        nodeName: name,\n        attributes: attributes || {},\n        children: children,\n        key: attributes && attributes.key\n      }\n}\n\nfunction app(state, actions, view, container) {\n  var map = [].map;\n  var rootElement = (container && container.children[0]) || null;\n  var oldNode = rootElement && recycleElement(rootElement);\n  var lifecycle = [];\n  var skipRender;\n  var isRecycling = true;\n  var globalState = clone(state);\n  var wiredActions = wireStateToActions([], globalState, clone(actions));\n\n  scheduleRender();\n\n  return wiredActions\n\n  function recycleElement(element) {\n    return {\n      nodeName: element.nodeName.toLowerCase(),\n      attributes: {},\n      children: map.call(element.childNodes, function(element) {\n        return element.nodeType === 3 // Node.TEXT_NODE\n          ? element.nodeValue\n          : recycleElement(element)\n      })\n    }\n  }\n\n  function resolveNode(node) {\n    return typeof node === \"function\"\n      ? resolveNode(node(globalState, wiredActions))\n      : node != null ? node : \"\"\n  }\n\n  function render() {\n    skipRender = !skipRender;\n\n    var node = resolveNode(view);\n\n    if (container && !skipRender) {\n      rootElement = patch(container, rootElement, oldNode, (oldNode = node));\n    }\n\n    isRecycling = false;\n\n    while (lifecycle.length) lifecycle.pop()();\n  }\n\n  function scheduleRender() {\n    if (!skipRender) {\n      skipRender = true;\n      setTimeout(render);\n    }\n  }\n\n  function clone(target, source) {\n    var out = {};\n\n    for (var i in target) out[i] = target[i];\n    for (var i in source) out[i] = source[i];\n\n    return out\n  }\n\n  function set(path, value, source) {\n    var target = {};\n    if (path.length) {\n      target[path[0]] =\n        path.length > 1 ? set(path.slice(1), value, source[path[0]]) : value;\n      return clone(source, target)\n    }\n    return value\n  }\n\n  function get(path, source) {\n    var i = 0;\n    while (i < path.length) {\n      source = source[path[i++]];\n    }\n    return source\n  }\n\n  function wireStateToActions(path, state, actions) {\n    for (var key in actions) {\n      typeof actions[key] === \"function\"\n        ? (function(key, action) {\n            actions[key] = function(data) {\n              var result = action(data);\n\n              if (typeof result === \"function\") {\n                result = result(get(path, globalState), actions);\n              }\n\n              if (\n                result &&\n                result !== (state = get(path, globalState)) &&\n                !result.then // !isPromise\n              ) {\n                scheduleRender(\n                  (globalState = set(path, clone(state, result), globalState))\n                );\n              }\n\n              return result\n            };\n          })(key, actions[key])\n        : wireStateToActions(\n            path.concat(key),\n            (state[key] = clone(state[key])),\n            (actions[key] = clone(actions[key]))\n          );\n    }\n\n    return actions\n  }\n\n  function getKey(node) {\n    return node ? node.key : null\n  }\n\n  function eventListener(event) {\n    return event.currentTarget.events[event.type](event)\n  }\n\n  function updateAttribute(element, name, value, oldValue, isSvg) {\n    if (name === \"key\") {\n    } else if (name === \"style\") {\n      for (var i in clone(oldValue, value)) {\n        var style = value == null || value[i] == null ? \"\" : value[i];\n        if (i[0] === \"-\") {\n          element[name].setProperty(i, style);\n        } else {\n          element[name][i] = style;\n        }\n      }\n    } else {\n      if (name[0] === \"o\" && name[1] === \"n\") {\n        name = name.slice(2);\n\n        if (element.events) {\n          if (!oldValue) oldValue = element.events[name];\n        } else {\n          element.events = {};\n        }\n\n        element.events[name] = value;\n\n        if (value) {\n          if (!oldValue) {\n            element.addEventListener(name, eventListener);\n          }\n        } else {\n          element.removeEventListener(name, eventListener);\n        }\n      } else if (name in element && name !== \"list\" && !isSvg) {\n        element[name] = value == null ? \"\" : value;\n      } else if (value != null && value !== false) {\n        element.setAttribute(name, value);\n      }\n\n      if (value == null || value === false) {\n        element.removeAttribute(name);\n      }\n    }\n  }\n\n  function createElement(node, isSvg) {\n    var element =\n      typeof node === \"string\" || typeof node === \"number\"\n        ? document.createTextNode(node)\n        : (isSvg = isSvg || node.nodeName === \"svg\")\n          ? document.createElementNS(\n              \"http://www.w3.org/2000/svg\",\n              node.nodeName\n            )\n          : document.createElement(node.nodeName);\n\n    var attributes = node.attributes;\n    if (attributes) {\n      if (attributes.oncreate) {\n        lifecycle.push(function() {\n          attributes.oncreate(element);\n        });\n      }\n\n      for (var i = 0; i < node.children.length; i++) {\n        element.appendChild(\n          createElement(\n            (node.children[i] = resolveNode(node.children[i])),\n            isSvg\n          )\n        );\n      }\n\n      for (var name in attributes) {\n        updateAttribute(element, name, attributes[name], null, isSvg);\n      }\n    }\n\n    return element\n  }\n\n  function updateElement(element, oldAttributes, attributes, isSvg) {\n    for (var name in clone(oldAttributes, attributes)) {\n      if (\n        attributes[name] !==\n        (name === \"value\" || name === \"checked\"\n          ? element[name]\n          : oldAttributes[name])\n      ) {\n        updateAttribute(\n          element,\n          name,\n          attributes[name],\n          oldAttributes[name],\n          isSvg\n        );\n      }\n    }\n\n    var cb = isRecycling ? attributes.oncreate : attributes.onupdate;\n    if (cb) {\n      lifecycle.push(function() {\n        cb(element, oldAttributes);\n      });\n    }\n  }\n\n  function removeChildren(element, node) {\n    var attributes = node.attributes;\n    if (attributes) {\n      for (var i = 0; i < node.children.length; i++) {\n        removeChildren(element.childNodes[i], node.children[i]);\n      }\n\n      if (attributes.ondestroy) {\n        attributes.ondestroy(element);\n      }\n    }\n    return element\n  }\n\n  function removeElement(parent, element, node) {\n    function done() {\n      parent.removeChild(removeChildren(element, node));\n    }\n\n    var cb = node.attributes && node.attributes.onremove;\n    if (cb) {\n      cb(element, done);\n    } else {\n      done();\n    }\n  }\n\n  function patch(parent, element, oldNode, node, isSvg) {\n    if (node === oldNode) {\n    } else if (oldNode == null || oldNode.nodeName !== node.nodeName) {\n      var newElement = createElement(node, isSvg);\n      parent.insertBefore(newElement, element);\n\n      if (oldNode != null) {\n        removeElement(parent, element, oldNode);\n      }\n\n      element = newElement;\n    } else if (oldNode.nodeName == null) {\n      element.nodeValue = node;\n    } else {\n      updateElement(\n        element,\n        oldNode.attributes,\n        node.attributes,\n        (isSvg = isSvg || node.nodeName === \"svg\")\n      );\n\n      var oldKeyed = {};\n      var newKeyed = {};\n      var oldElements = [];\n      var oldChildren = oldNode.children;\n      var children = node.children;\n\n      for (var i = 0; i < oldChildren.length; i++) {\n        oldElements[i] = element.childNodes[i];\n\n        var oldKey = getKey(oldChildren[i]);\n        if (oldKey != null) {\n          oldKeyed[oldKey] = [oldElements[i], oldChildren[i]];\n        }\n      }\n\n      var i = 0;\n      var k = 0;\n\n      while (k < children.length) {\n        var oldKey = getKey(oldChildren[i]);\n        var newKey = getKey((children[k] = resolveNode(children[k])));\n\n        if (newKeyed[oldKey]) {\n          i++;\n          continue\n        }\n\n        if (newKey == null || isRecycling) {\n          if (oldKey == null) {\n            patch(element, oldElements[i], oldChildren[i], children[k], isSvg);\n            k++;\n          }\n          i++;\n        } else {\n          var keyedNode = oldKeyed[newKey] || [];\n\n          if (oldKey === newKey) {\n            patch(element, keyedNode[0], keyedNode[1], children[k], isSvg);\n            i++;\n          } else if (keyedNode[0]) {\n            patch(\n              element,\n              element.insertBefore(keyedNode[0], oldElements[i]),\n              keyedNode[1],\n              children[k],\n              isSvg\n            );\n          } else {\n            patch(element, oldElements[i], null, children[k], isSvg);\n          }\n\n          newKeyed[newKey] = children[k];\n          k++;\n        }\n      }\n\n      while (i < oldChildren.length) {\n        if (getKey(oldChildren[i]) == null) {\n          removeElement(element, oldElements[i], oldChildren[i]);\n        }\n        i++;\n      }\n\n      for (var i in oldKeyed) {\n        if (!newKeyed[i]) {\n          removeElement(element, oldKeyed[i][0], oldKeyed[i][1]);\n        }\n      }\n    }\n    return element\n  }\n}\n\nexports.h = h;\nexports.app = app;\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\n})));\n//# sourceMappingURL=hyperapp.js.map\n"]}